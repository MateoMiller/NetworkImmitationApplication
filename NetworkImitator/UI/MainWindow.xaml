<Window x:Class="NetworkImitator.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:networkComponents="clr-namespace:NetworkImitator.NetworkComponents"
        xmlns:ui="clr-namespace:NetworkImitator.UI"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        Title="Graph App" Height="600" Width="1200">
    <Window.Resources>
        <ObjectDataProvider x:Key="AlgorithmValues" MethodName="GetValues" 
                           ObjectType="{x:Type system:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="networkComponents:LoadBalancerAlgorithm"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        <ObjectDataProvider x:Key="ClientModeValues" MethodName="GetValues" 
                           ObjectType="{x:Type system:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="networkComponents:ClientMode"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="1">
            <Button Content="Добавить компьютер" Command="{Binding AddClientCommand}"/>
            <Button Content="Добавить сервер" Command="{Binding AddServerCommand}"/>
            <Button Content="Добавить балансировщик нагрузки" Command="{Binding AddLoadBalancerCommand}"/>
            <Button Content="Добавить ребро" Command="{Binding AddConnectionCommand}"/>
        </StackPanel>
    
        <Canvas Name="ComponentsCanvas" Grid.Column="0" Background="LightGray" MouseMove="OnCanvasMouseMove">
            <ItemsControl ItemsSource="{Binding Components}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter">
                        <Setter Property="Canvas.Left" Value="{Binding X}"/>
                        <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                    </Style>
                </ItemsControl.ItemContainerStyle>
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type networkComponents:Component}">
                        <ui:ComponentControl Component="{Binding }" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>       
        </Canvas>
        
        <StackPanel Grid.Column="2" Margin="10">
            <TextBlock Text="Настройки" FontWeight="Bold" FontSize="16"/>
            <ContentControl Content="{Binding SelectedComponent}">
                <ContentControl.Resources>
                    <DataTemplate x:Key="CommonIpAddressTemplate">
                        <StackPanel>
                            <TextBlock Text="IP адрес"/>
                            <TextBox Text="{Binding IP, UpdateSourceTrigger=PropertyChanged}" IsEnabled="False" />
                            <TextBlock Text="Имя компонента"/>
                            <TextBox Text="{Binding DeviceName, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>
                    </DataTemplate>
                    <DataTemplate DataType="{x:Type networkComponents:Client}">
                        <StackPanel>
                            <TextBlock Text="Режим работы:"/>
                            <ComboBox ItemsSource="{Binding Source={StaticResource ClientModeValues}}"
                                      SelectedItem="{Binding ClientMode}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <TextBlock.Text>
                                                <MultiBinding StringFormat="{}{0}">
                                                    <Binding />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <TextBlock Text="Период отправки пакетов:"/>
                            <TextBox Text="{Binding SendingPacketPeriod, UpdateSourceTrigger=PropertyChanged}" />
                            <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource CommonIpAddressTemplate}" />
                        </StackPanel>
                    </DataTemplate>
                    <DataTemplate DataType="{x:Type networkComponents:Server}">
                        <StackPanel>
                            <TextBlock Text="Время обработки (мс):"/>
                            <TextBox Text="{Binding TimeToProcessMs, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="Макс. одновременных пакетов:"/>
                            <TextBox Text="{Binding MaxConcurrentPackets}" />
                            <TextBlock>
                                <Run Text="Сейчас обрабатывается пакетов: "/>
                                <Run Text="{Binding GetProcessingLoad, Mode=OneWay}"/>
                                <Run Text=" из "/>
                                <Run Text="{Binding GetTotalLoad, Mode=OneWay}"/>
                            </TextBlock>
                            <TextBlock>
                                <Run Text="В очереди: "/>
                                <Run Text="{Binding GetQueuedMessagesCount, Mode=OneWay}"/>
                            </TextBlock>
                            <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource CommonIpAddressTemplate}" />
                        </StackPanel>
                    </DataTemplate>
                    <DataTemplate DataType="{x:Type networkComponents:LoadBalancer}">
                        <StackPanel>
                            <TextBlock Text="Алгоритм балансировки:"/>
                            <ComboBox ItemsSource="{Binding Source={StaticResource AlgorithmValues}}"
                                      SelectedItem="{Binding Algorithm}"/>
                            <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource CommonIpAddressTemplate}" />
                        </StackPanel>
                    </DataTemplate>
                </ContentControl.Resources>
            </ContentControl>
            
            <ContentControl Content="{Binding SelectedConnection}">
                <ContentControl.Resources>
                    <DataTemplate DataType="{x:Type networkComponents:Connection}">
                        <StackPanel>
                            <TextBlock Text="Настройки соединения" FontWeight="Bold" Margin="0,10,0,5"/>
                            <TextBlock Text="{Binding DisplayName}" FontStyle="Italic"/>
                            <TextBlock Text="Базовое время передачи пакета (мс):"/>
                            <TextBox Text="{Binding TimeToProcessMs, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="Время передачи 1 байта (мс):"/>
                            <TextBox Text="{Binding ByteTransferTimeMs, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Text="Состояние соединения:"/>
                            <TextBlock>
                                <Run Text="Сообщений в пути: "/>
                                <Run Text="{Binding MessagesInTransitCount, Mode=OneWay}"/>
                            </TextBlock>            
                            <CheckBox Content="Активно" IsChecked="{Binding IsActive, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                    </DataTemplate>
                </ContentControl.Resources>
            </ContentControl>
        </StackPanel>
    </Grid>
</Window>